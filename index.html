<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ErgoBot - Ergonomics Self-Check</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      padding: 10px;
    }
    #chatbox {
      background: white;
      max-width: 600px;
      margin: auto;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .welcome {
      background-color: #b91e71;
      color: #fff;
      text-align: left;
    }
    .message {
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #dee2e6;
      border-radius: 8px;
    }
    .bot {
      background-color: #FCE8F2;
      text-align: left;
      margin-right: 10%;
    }
    .user {
      background-color: #e9ecef;
      text-align: center;
      margin-left: 50%;
    }
    .buttons {
      margin-top: 10px;
      text-align: center;
    }
    button {
      padding: 8px 15px;
      margin: 5px;
      background-color: #b91e71;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .tip-image {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 5px;
    }
    input, textarea {
      width: 98%;
      padding: 8px;
      margin: 5px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .typing {
      font-style: italic;
      color: gray;
      margin: 5px;
      animation: blink 1.5s infinite;
    }
    @keyframes blink {
      50% { opacity: 0.3; }
    }
  </style>
</head>
<body>
  <div id="userInfoForm" style="max-width:600px;margin:auto;background:white;padding:15px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.1);margin-bottom:20px;">
    <h3 style="color:#b91e71;">Before we begin</h3>
    <p>Please fill out your details:</p>

    <!-- ✅ Updated input fields with aria-labels -->
    <input id="Name" placeholder="Your name" aria-label="Your full name" required>
    <input id="baseSite" placeholder="Base/site" aria-label="Your base or work site" required>
    <input id="Job title" placeholder="Job title" aria-label="Your job title" required>
    <input id="deskNumber" placeholder="Desk number (if applicable)" aria-label="Your desk number if applicable">

    <button onclick="startAssessment()">Start Self-Check</button>
  </div>

  <div id="chatbox">
    <div class="message welcome" id="welcome">Hi! I'm <strong>ErgoBot</strong>. Let's go through a quick office ergonomics self-check.</div>
    <div id="messages"></div>
    <div id="controls" class="buttons"></div>
  </div>

  <script>
    const messages = document.getElementById('messages');
    const controls = document.getElementById('controls');
    const welcomeMessage = document.getElementById('welcome');
    document.getElementById('chatbox').style.display = 'none';

    // -------------------------
    // PDF Helper for proper bullets
    // -------------------------
    function htmlListToBulletArray(html) {
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = html;

      const results = [];

      function traverse(node, prefix = '') {
        node.childNodes.forEach(child => {
          if (child.nodeName === 'LI') {
            results.push(`${prefix}• ${child.textContent.trim()}`);
            traverse(child, prefix + '  ');
          } else if (child.nodeName === 'UL') {
            traverse(child, prefix + '  ');
          } else if (child.nodeType === 3) {
            const text = child.textContent.trim();
            if (text) results.push(prefix + text);
          } else if (child.childNodes.length) {
            traverse(child, prefix);
          }
        });
      }

      traverse(tempDiv);
      return results;
    }

    function formatHTMLtoText(html) {
      const tempDiv = document.createElement("div");
      tempDiv.innerHTML = html;

      const bullets = htmlListToBulletArray(html);
      tempDiv.innerHTML = tempDiv.innerHTML.replace(/<br\s*\/?>/gi, '\n');
      const text = tempDiv.textContent || tempDiv.innerText || "";

      if (bullets.length) return bullets.join('\n');
      return text;
    }

    // -------------------------
    // Questions, user state, and other chat logic
    // (unchanged, same as your code)
    // -------------------------
    const questions = [
      {
        text: "Can you find a comfortable keying position? (As seen in image below). You should sit upright and have room to rest your palms or wrists on the desk to provide support.",
        tip: "Try pushing the display screen further back to create more room for the keyboard, hands and wrists. Users of thick, raised keyboards may need a wrist rest. <br>Or move the keyboard to allow adequate support for palm of hand on desk or space for wrist support.",
        image: "Elbow ergo1.png"
      },
      {
        text: "Do you have good keyboard technique? <br> You should avoid<ul><li>Having hands bent up at the wrist</li><li>Hitting the keys too hard</li><li>Overstretching the fingers</li></ul>",
        tip: "<i>Need to write some suitable advice here.</i>",
      },
      {
        text: "Are the characters on your keyboard clear and readable?",
        tip: "Clean your keyboard using the wipes provided at workstations. If characters still can’t be read, the keyboard may need modifying or replacing. Use a keyboard with a matt finish to reduce glare and/or reflection.",
        followUp: {
          text: "Do you need a new keyboard?",
          field: "newKeyboard"
        }
      },
      {
        text: "Is the mouse you use suitable for the tasks you do?",
        tip: "Different shapes and sizes of mouse are available. Or, an alternative device such as a tablet may suit your task.",
        followUp: {
          text: "Do you need a different mouse or alternative device?",
          field: "newMouse or alt device"
        }
      },
      {
        text: "Do you hold the mouse close to the keyboard as shown in the first picture? <br> Check you meet this guidance:<ul><li>Most devices are best placed as close as possible to the keyboard</li><li>Arm should not overreach</li><li>Users should not leave their hand on the device when not in use (hovering)</li><li>User should have a relaxed arm and straight wrist</li></ul>",
        tip: "Adjust the way that you hold the mouse:<ul><li>Most devices are best placed as close as possible to the keyboard</li><li>Arm should not overreach</li><li>Users should not leave their hand on the device when not in use (hovering)</li><li>User should have a relaxed arm and straight wrist</li></ul>",
        image: "Mouse hold.png"
      },
      {
        text: "Can you find a comfortable working position while using the mouse? You should be able to support your arm and wrist using the desk surface or arm of chair?",
        tip: "Mouse mats with built in wrist supports are available to you should you require one.",
      },
      {
        text: "Does the mouse work smoothly at a speed that suits you?",
        tip: "Clean the mouse. <br> <ul><li>A roller ball mouse collects desk debris and needs regular cleaning</li><li>A light operated mouse collects dust on the feet and in the light recess; they may also react differently on polished /matt surfaces</li></ul>",
        followUp: {
          text: "Do you require a replacement mouse?",
          field: "newMouse"
        }
      },
      {
        text: "Placeholder for next question",
        tip: "Placeholder for first stage help",
        extraTip: "Placeholder for second stage help",
      },
    ];


  </script>

</body>
</html>
